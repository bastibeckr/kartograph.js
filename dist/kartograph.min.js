(function(){function t(){var t={},e=[],n=1,o=1;return t.size=function(r){return arguments.length?(o=r,t):o},t.iterations=function(r){return arguments.length?(n=r,t):n},t.add=function(r){return e.push(r),t},t.means=function(){for(var t=[],a={},i=Math.min(o,e.length),s=0,l=2*i;l>s;s++){var u=e[~~(Math.random()*e.length)],p=u.x+"/"+u.y;if(!(p in a)&&(a[p]=1,t.push({x:u.x,y:u.y})>=i))break}i=t.length;for(var h=0;n>h;h++){for(var c=r().points(t),s=0;i>s;s++){var f=t[s];f.sumX=0,f.sumY=0,f.size=0,f.points=[],f.indices=[]}for(var s=0;s<e.length;s++){var y=e[s],f=c.find(y);f.sumX+=y.x,f.sumY+=y.y,f.size++,f.points.push(y),f.indices.push(s)}for(var s=0;i>s;s++){var f=t[s];f.size&&(f.x=f.sumX/f.size,f.y=f.sumY/f.size)}}return t},t}function r(){function t(r,n){if(r.length){var o=i[n%i.length],a=r.length>>1;return r.sort(e(o)),{axis:o,point:r[a],left:t(r.slice(0,a),n+1),right:t(r.slice(a+1),n+1)}}}function r(t,r){for(var e=0,n=0;n<i.length;n++){var o=i[n],a=t[o]-r[o];e+=a*a}return e}function e(t){return function(r,e){return r=r[t],e=e[t],e>r?-1:r>e?1:0}}function n(t,e,o){if(r(t.point,e)<r(o.point,e)&&(o=t),t.left&&(o=n(t.left,e,o)),t.right){var a=t.point[t.axis]-e[t.axis];a*a<r(o.point,e)&&(o=n(t.right,e,o))}return o}var o,a={},i=["x","y"],s=[];return a.axes=function(t){return arguments.length?(i=t,a):i},a.points=function(t){return arguments.length?(s=t,o=null,a):s},a.find=function(t){return n(a.root(),t,o).point},a.root=function(r){return o||(o=t(s,0))},a}var e,n,o,a,i,l,u,p,h,c,f,y,d,v,g,b,x,_,w,M,P,L,j,k,B,A,S,I,C,z,T,G,N,V,O,E,X,D,U,R,q,F,H,Z,Y,$=function(t,r){function e(){this.constructor=t}for(var n in r)Q.call(r,n)&&(t[n]=r[n]);return e.prototype=r.prototype,t.prototype=new e,t.__super__=r.prototype,t},Q={}.hasOwnProperty,K=function(t,r){return function(){return t.apply(r,arguments)}},J=[].indexOf||function(t){for(var r=0,e=this.length;e>r;r++)if(r in this&&this[r]===t)return r;return-1};H="undefined"!=typeof exports&&null!==exports?exports:this,V=H.$K=null!=H.kartograph?H.kartograph:H.kartograph={},V.version="0.8.7",e=H.jQuery,V.__verbose=!1,Y=function(t){var r,e,n;try{return console.warn.apply(console,arguments)}catch(e){r=e;try{return opera.postError.apply(opera,arguments)}catch(n){return r=n,alert(Array.prototype.join.call(arguments," "))}}},O=function(t){var r,e,n;if(V.__verbose)try{return console.debug.apply(console,arguments)}catch(e){r=e;try{return opera.postError.apply(opera,arguments)}catch(n){return r=n,alert(Array.prototype.join.call(arguments," "))}}},null==(T=String.prototype).trim&&(T.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){"use strict";if(null==this)throw new TypeError;var r=Object(this),e=r.length>>>0;if(0===e)return-1;var n=0;if(arguments.length>0&&(n=Number(arguments[1]),n!=n?n=0:0!=n&&n!=1/0&&n!=-(1/0)&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=e)return-1;for(var o=n>=0?n:Math.max(e-Math.abs(n),0);e>o;o++)if(o in r&&r[o]===t)return o;return-1}),z=function(){var t,r,e,n,o;for(t={},n="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),o=0,r=n.length;r>o;o++)e=n[o],t["[object "+e+"]"]=e.toLowerCase();return function(r){var e;return e=Object.prototype.toString.call(r),t[e]||"object"}}(),o=function(){function t(t,r,e,n){var o;null==t&&(t=0),null==r&&(r=0),null==e&&(e=null),null==n&&(n=null),o=this,null===e?(o.xmin=Number.MAX_VALUE,o.xmax=-1*Number.MAX_VALUE):(o.xmin=o.left=t,o.xmax=o.right=t+e,o.width=e),null===n?(o.ymin=Number.MAX_VALUE,o.ymax=-1*Number.MAX_VALUE):(o.ymin=o.top=r,o.ymax=o.bottom=n+r,o.height=n)}return t.prototype.update=function(t,r){var e;return null==r&&(r=t[1],t=t[0]),e=this,e.xmin=Math.min(e.xmin,t),e.ymin=Math.min(e.ymin,r),e.xmax=Math.max(e.xmax,t),e.ymax=Math.max(e.ymax,r),e.left=e.xmin,e.top=e.ymin,e.right=e.xmax,e.bottom=e.ymax,e.width=e.xmax-e.xmin,e.height=e.ymax-e.ymin,this},t.prototype.intersects=function(t){return t.left<s.right&&t.right>s.left&&t.top<s.bottom&&t.bottom>s.top},t.prototype.inside=function(t,r){var e;return e=this,t>=e.left&&t<=e.right&&r>=e.top&&r<=e.bottom},t.prototype.join=function(t){var r;return r=this,r.update(t.left,t.top),r.update(t.right,t.bottom),this},t}(),o.fromXML=function(t){var r,e,n,a;return n=Number(t.getAttribute("x")),a=Number(t.getAttribute("y")),e=Number(t.getAttribute("w")),r=Number(t.getAttribute("h")),new o(n,a,e,r)},V.BBox=o,null==V.geom&&(V.geom={}),null==(G=V.geom).clipping&&(G.clipping={}),l=function(){function t(){}var r,e,n,o,a;return e=0,n=1,o=2,r=4,a=8,t.prototype.compute_out_code=function(t,r,e){var n,o;return o=this,n=o.INSIDE,r<t.left?n|=o.LEFT:r>t.right&&(n|=o.RIGHT),e<t.top?n|=o.TOP:e>t.bottom&&(n|=o.BOTTOM),n},t.prototype.clip=function(t,r,e,n,o){var a,i,s,l,u,p,h;for(u=this,i=u.compute_out_code(t,r,e),s=u.compute_out_code(t,n,o),a=False;True;){if(!(i|s)){a=True;break}if(i&s)break;l=0===code?s:i,l&u.TOP?(p=r+(n-r)*(t.top-e)/(o-e),h=t.top):l&u.BOTTOM?(p=r+(n-r)*(t.bottom-e)/(o-e),h=t.bottom):l&u.RIGHT?(h=e+(o-e)*(t.right-r)/(n-r),p=t.right):l&u.LEFT&&(h=e+(o-e)*(t.left-r)/(n-r),p=t.left),l===i?(r=p,e=h,i=u.compute_out_code(t,r,e)):(n=p,o=h,s=u.compute_out_code(t,n,o))}return a?[r,e,n,o]:null},t}(),V.geom.clipping.CohenSutherland=l,h=function(){function t(t,r,n){var o,a;a=this,a.container=o=e(t),null==r&&(r=o.width()),null==n&&(n=o.height()),0===n&&(n="auto"),a.size={h:n,w:r},a.markers=[],a.pathById={},a.container.addClass("kartograph")}return t.prototype.createSVGLayer=function(t){var r,n,o,a,i,s,l;return a=this,null==a._layerCnt&&(a._layerCnt=0),o=a._layerCnt++,l=a.viewport,n=a.container,i=Snap(l.width,l.height),n.append(i.node),s=e(i.node),s.css({position:"absolute",top:"0px",left:"0px","z-index":o+5}),"static"===n.css("position")&&n.css({position:"relative",height:l.height+"px"}),s.addClass(t),r=e("desc",i.node).text(),e("desc",i.node).text(r.replace("with ","with kartograph "+V.version+" and ")),i},t.prototype.createHTMLLayer=function(t){var r,n,o,a,i;return a=this,i=a.viewport,r=a.container,null==a._layerCnt&&(a._layerCnt=0),o=a._layerCnt++,n=e('<div class="layer '+t+'" />'),n.css({position:"absolute",top:"0px",left:"0px",width:i.width+"px",height:i.height+"px","z-index":o+5}),r.append(n),n},t.prototype.load=function(t,r,n){var o,a,i;return i=this,a=e.Deferred(),i.clear(),i.opts=null!=n?n:{},null==(o=i.opts).zoom&&(o.zoom=1),i.mapLoadCallback=r,i._loadMapDeferred=a,i._lastMapUrl=t,i.cacheMaps&&null!=V.__mapCache[t]?i._mapLoaded(V.__mapCache[t]):e.ajax({url:t,dataType:"text",success:i._mapLoaded,context:i,error:function(t,r,e){return Y(t,r,e)}}),a.promise()},t.prototype.loadMap=function(){return this.load.apply(this,arguments)},t.prototype.setMap=function(t,r){var e,n;n=this,n.opts=null!=r?r:{},null==(e=n.opts).zoom&&(e.zoom=1),n._lastMapUrl="string",n._mapLoaded(t)},t.prototype._mapLoaded=function(t){var r,n,a,i,s,l,u,p,h,c,f,y,d,v,g,m,b;u=this,u.cacheMaps&&(null==V.__mapCache&&(V.__mapCache={}),V.__mapCache[u._lastMapUrl]=t);try{t=e(t)}catch(i){return a=i,Y("something went horribly wrong while parsing svg"),void u._loadMapDeferred.reject("could not parse svg")}u.svgSrc=t,r=e("view",t),null==u.paper&&(m=u.size.w,s=u.size.h,"auto"===s&&(h=r.attr("w")/r.attr("h"),s=m/h),u.viewport=new o(0,0,m,s)),g=u.viewport,u.viewAB=n=A.fromXML(r[0]),p=null!=(c=u.opts.padding)?c:0,l=null!=(f=u.opts.halign)?f:"center",v=null!=(y=u.opts.valign)?y:"center",b=null!=(d=u.opts.zoom)?d:1,u.viewBC=new A(u.viewAB.asBBox(),g.width*b,g.height*b,p,l,v),u.proj=V.Proj.fromXML(e("proj",r)[0]),null!=u.mapLoadCallback&&u.mapLoadCallback(u),null!=u._loadMapDeferred&&u._loadMapDeferred.resolve(u)},t.prototype.addLayer=function(t,r){var n,o,a,i,s,l,u,p,h,c,f,y,d,g,m;return null==r&&(r={}),u=this,null==u.layerIds&&(u.layerIds=[]),null==u.layers&&(u.layers={}),null==u.paper&&(u.paper=u.createSVGLayer()),d=t,"object"===z(r)?(s=r.name,c=r.key,m=r.title):r={},l=u.paper,r.add_svg_layer&&(l=u.createSVGLayer()),null==s&&(s=d),g=e("#"+d,u.svgSrc),0!==g.length?(i=new v(s,c,u,r.filter,l),n=e("*",g[0]),y=n.length,o=null!=(f=r.chunks)?f:y,a=0,h=function(){var t,e,s,l,u,c,f;for(t=o*a,e=c=0,l=o;l>=0?l>c:c>l;e=l>=0?++c:--c)y>t+e&&i.addPath(n.get(t+e),m);if(null!=r.styles){u=r.styles;for(s in u)f=u[s],i.style(s,f)}return a++,y>a*o?setTimeout(h,0):p()},p=function(){var t,e,n,o;for(i.paths.length>0&&(u.layers[s]=i,u.layerIds.push(s)),t=["click","mouseenter","mouseleave","dblclick","mousedown","mouseup","mouseover","mouseout"],o=0,n=t.length;n>o;o++)e=t[o],"function"===z(r[e])&&i.on(e,r[e]);return null!=r.tooltips&&i.tooltips(r.tooltips),null!=r.done?r.done():void 0},null!=r.chunks?setTimeout(h,0):h(),u):void 0},t.prototype.getLayer=function(t){var r;return r=this,null==r.layers[t]?(Y("could not find layer "+t),null):r.layers[t]},t.prototype.getLayerPath=function(t,r){var e,n;return n=this,e=n.getLayer(t),null!=e?"object"===z(r)?e.getPaths(r)[0]:e.getPath(r):null},t.prototype.onLayerEvent=function(t,r,e){var n;return n=this,n.getLayer(e).on(t,r),n},t.prototype.addMarker=function(t){var r,e;return r=this,r.markers.push(t),e=r.viewBC.project(r.viewAB.project(r.proj.project(t.lonlat.lon,t.lonlat.lat))),t.render(e[0],e[1],r.container,r.paper)},t.prototype.clearMarkers=function(){var t,r,e,n,o;for(e=this,n=e.markers,o=0,t=n.length;t>o;o++)r=n[o],r.clear();return e.markers=[]},t.prototype.fadeIn=function(t){var r,e,n,o,a,i,s,l,u,p,h;null==t&&(t={}),a=this,o=null!=(l=t.layer)?l:a.layerIds[a.layerIds.length-1],e=null!=(u=t.duration)?u:500,p=a.layers[o].pathsById,h=[];for(n in p)s=p[n],h.push(function(){var t,n,o;for(n=[],o=0,t=s.length;t>o;o++)i=s[o],r="function"===z(e)?e(i.data):e,i.svgPath.attr("opacity",0),n.push(i.svgPath.animate({opacity:1},r));return n}());return h},t.prototype.loadCoastline=function(){var t;return t=this,e.ajax({url:"coastline.json",success:t.renderCoastline,context:t})},t.prototype.resize=function(t,r){var e,n,a,i,s,l,u,p,h,c,f,y,d,v,g,m,b;l=this,e=l.container,null==t&&(t=e.width()),null==r&&(r=e.height()),l.viewport=m=new o(0,0,t,r),u=null!=(p=l.opts.padding)?p:0,n=null!=(h=l.opts.halign)?h:"center",g=null!=(c=l.opts.valign)?c:"center",b=l.opts.zoom,l.viewBC=new A(l.viewAB.asBBox(),m.width*b,m.height*b,u,n,g),f=l.layers;for(a in f)i=f[a],i.setView(l.viewBC);if(null!=l.symbolGroups)for(y=l.symbolGroups,v=0,s=y.length;s>v;v++)d=y[v],d.onResize()},t.prototype.lonlat2xy=function(t){var r,e;return e=this,2===t.length&&(t=new d(t[0],t[1])),3===t.length&&(t=new d(t[0],t[1],t[2])),r=e.proj.project(t.lon,t.lat,t.alt),e.viewBC.project(e.viewAB.project(r))},t.prototype.addSymbolGroup=function(t){var r;return r=this,null==r.symbolGroups&&(r.symbolGroups=[]),r.symbolGroups.push(t)},t.prototype.removeSymbols=function(t){var r,e,n,o,a,i;if(e=this,null!=t)return e.symbolGroups[t].remove();for(n=e.symbolGroups,o=[],i=0,r=n.length;r>i;i++)a=n[i],o.push(a.remove());return o},t.prototype.clear=function(){var t,r,n,o,a,i;if(n=this,null!=n.layers){for(t in n.layers)n.layers[t].remove();n.layers={},n.layerIds=[]}if(null!=n.symbolGroups){for(o=n.symbolGroups,i=0,r=o.length;r>i;i++)a=o[i],a.remove();n.symbolGroups=[]}return null!=n.paper?(e(n.paper.canvas).remove(),n.paper=void 0):void 0},t.prototype.loadCSS=function(t,r){var n;return n=this,e("body").append('<link rel="stylesheet" href="'+t+'" />'),r()},t.prototype.applyCSS=function(t,r){var e,n,o,a,i,s,l,u,p,h,c,f,y;if(i=this,null==i.styles)return t;null==i._pathTypes&&(i._pathTypes=["path","circle","rectangle","ellipse"]),null==i._regardStyles&&(i._regardStyles=["fill","stroke","fill-opacity","stroke-width","stroke-opacity"]);for(h in i.styles)for(s=h,u=s.split(","),f=0,o=u.length;o>f;f++)if(c=u[f],s=c.split(" "),s=s[s.length-1],s=s.split(":"),!(s.length>1||(s=s[0].split("."),e=s.slice(1),e.length>0&&e.indexOf(r)<0||(s=s[0],i._pathTypes.indexOf(s)>=0&&s!==t.type))))for(l=i.styles[h],p=i._regardStyles,y=0,a=p.length;a>y;y++)n=p[y],null!=l[n]&&t.attr(n,l[n]);return t},t.prototype.style=function(t,r,e,n,o){var a;return a=this,t=a.getLayer(t),null!=t?t.style(r,e,n,o):void 0},t}(),p=V,H.kartograph=function(t,r,e){return new h(t,r,e)},V.map=function(t,r,e){return new h(t,r,e)},V.__mapCache={},e.extend(H.kartograph,p),d=function(){function t(t,r,e){null==e&&(e=0),this.lon=Number(t),this.lat=Number(r),this.alt=Number(e)}return t.prototype.distance=function(t){var r,e,n,o,a,i,s,l,u;return u=this,r=6371,i=Math.PI/180,o=(t.lat-u.lat)*i,a=(t.lon-u.lon)*i,s=u.lat*i,l=t.lat*i,e=Math.sin(o/2)*Math.sin(o/2)+Math.sin(a/2)*Math.sin(a/2)*Math.cos(s)*Math.cos(l),n=2*Math.atan2(Math.sqrt(e),Math.sqrt(1-e)),r*n},t}(),f=function(t){function r(t,e,n){null==n&&(n=0),r.__super__.constructor.call(this,e,t,n)}return $(r,t),r}(d),H.kartograph.LonLat=d,H.kartograph.LatLon=f,v=function(){function t(t,r,e,n,o){var a;a=this,a.id=t,a.path_id=r,a.paper=null!=o?o:e.paper,a.view=e.viewBC,a.map=e,a.filter=n}return t.prototype.addPath=function(t,r){var e,n,o,a;return o=this,null==o.paths&&(o.paths=[]),n=new g(t,o.id,o,r),"function"===z(o.filter)&&o.filter(n.data)===!1?void n.remove():(o.paths.push(n),null!=o.path_id?(null==o.pathsById&&(o.pathsById={}),null==(e=o.pathsById)[a=n.data[o.path_id]]&&(e[a]=[]),o.pathsById[n.data[o.path_id]].push(n)):void 0)},t.prototype.hasPath=function(t){var r;return r=this,null!=r.pathsById&&null!=r.pathsById[t]},t.prototype.getPathsData=function(){var t,r,e,n,o,a;for(r=this,n=[],o=r.paths,a=0,t=o.length;t>a;a++)e=o[a],n.push(e.data);return n},t.prototype.getPath=function(t){var r;return r=this,r.hasPath(t)?r.pathsById[t][0]:null},t.prototype.getPaths=function(t){var r,e,n,o,a,i,s,l;if(a=this,o=[],"object"===z(t))for(s=a.paths,l=0,e=s.length;e>l;l++){i=s[l],n=!0;for(r in t)n=n&&i.data[r]===t[r];n&&o.push(i)}return o},t.prototype.setView=function(t){var r,e,n,o,a;for(e=this,o=e.paths,a=0,r=o.length;r>a;a++)n=o[a],n.setView(t);return e},t.prototype.remove=function(){var t,r,e,n,o,a;for(r=this,n=r.paths,o=[],a=0,t=n.length;t>a;a++)e=n[a],o.push(e.remove());return o},t.prototype.style=function(t,r,n,o){var a,i;return i=this,"string"===z(t)?(a=t,t={},t[a]=r):"object"===z(t)&&(o=n,n=r),null==n&&(n=0),e.each(i.paths,function(r,e){var a,i,s,l,u,p;i={};for(u in t)p=t[u],i[u]=q(p,e.data);return l=q(n,e.data),s=q(o,e.data),null==s&&(s=0),l>0?(a=Snap.animation(i,1e3*l),e.svgPath.animate(a.delay(1e3*s))):0===o?setTimeout(function(){return e.svgPath.attr(i)},0):e.svgPath.attr(i)}),i},t.prototype.on=function(t,r){var n,o,a,i,s,l,u;for(i=this,n=function(){function t(t,r,e){this.type=t,this.cb=r,this.layer=e,this.handle=K(this.handle,this)}return t.prototype.handle=function(t){var r;return i=this,r=i.layer.map.pathById[t.target.getAttribute("id")],i.cb(r.data,r.svgPath,t)},t}(),o=new n(t,r,i),l=i.paths,u=0,a=l.length;a>u;u++)s=l[u],e(s.svgPath.node).bind(t,o.handle);return i},t.prototype.tooltips=function(t,r){var n,o,a,i,s,l,u;for(o=this,s=function(t,n){var o;return o={position:{target:"mouse",viewport:e(window),adjust:{x:7,y:7}},show:{delay:null!=r?r:20},events:{show:function(t,r){return e(".qtip").filter(function(){return this!==r.elements.tooltip.get(0)}).hide()}},content:{}},null!=n?"string"==typeof n?o.content.text=n:e.isArray(n)&&(o.content.title=n[0],o.content.text=n[1]):o.content.text="n/a",e(t.svgPath.node).qtip(o)},i=o.paths,l=0,n=i.length;n>l;l++)a=i[l],u=q(t,a.data),s(a,u);return o},t.prototype.sort=function(t){var r,e,n,o,a,i;for(n=this,n.paths.sort(function(r,e){var n,o,a;return n=t(r.data),o=t(e.data),n===o?0:null!=(a=n>o)?a:{1:-1}}),e=!1,a=n.paths,i=0,r=a.length;r>i;i++)o=a[i],e&&o.svgPath.insertAfter(e.svgPath),e=o;return n},t}(),q=function(t,r){return"function"===z(t)?t(r):t},E=0,g=function(){function t(t,r,e,n){var o,a,i,s,l,u,p,h,c,f,y,d,v,g;for(l=this,u=e.paper,s=e.map,v=s.viewBC,l.path=p=V.geom.Path.fromSVG(t),l.vpath=v.projectPath(p),l.svgPath=l.vpath.toSVG(u),l.svgPath.data("path",l),null==s.styles?l.svgPath.node.setAttribute("class",r):s.applyCSS(l.svgPath,r),y="path_"+E++,l.svgPath.node.setAttribute("id",y),s.pathById[y]=l,a={},i=c=0,h=t.attributes.length-1;h>=0?h>=c:c>=h;i=h>=0?++c:--c)o=t.attributes[i],"data-"===o.name.substr(0,5)&&(d=o.value,g=Number(d),""===d.trim()||g!==d||isNaN(g)||(d=g),a[o.name.substr(5)]=d);l.data=a,"string"===z(n)?f=n:"function"===z(n)&&(f=n(a)),null!=f&&l.svgPath.attr("title",f)}return t.prototype.setView=function(t){var r,e,n;return r=this,e=t.projectPath(r.path),r.vpath=e,"path"===r.path.type?(n=e.svgString(),r.svgPath.attr({path:n})):"circle"===r.path.type?r.svgPath.attr({cx:e.x,cy:e.y,r:e.r}):void 0},t.prototype.remove=function(){var t;return t=this,t.svgPath.remove()},t}(),V.parsecss=function(t,r){var e,n,o,a,i,s,l,u;for(s={},t=X(t),i=t.split("`b%"),l=0,o=i.length;o>l;l++)if(e=i[l],e=e.split("%b`"),!(e.length<2))if(e[0]=F(e[0]),a=U(e[1]),null!=s[e[0]])for(n in a)u=a[n],s[e[0]][n]=u;else s[e[0]]=a;return"function"!==z(r)?s:void r(s)},D={},U=function(t){var r,e,n,o,a,i;for(a=D[t].replace(/^{|}$/g,""),a=X(a),n={},o=a.split(";"),i=0,e=o.length;e>i;i++)r=o[i],r=r.split(":"),r.length<2||(n[F(r[0])]=F(r.slice(1).join(":")));return n},_=/{[^{}]*}/,M=/\[[^\[\]]*\]|{[^{}]*}|\([^()]*\)|function(\s+\w+)?(\s*%b`\d+`b%){2}/,w=/(?:\/\*(?:[^\*]|\*[^\/])*\*\/)|(\\.|"(?:[^\\\"]|\\.|\\\n)*"|'(?:[^\\\']|\\.|\\\n)*')/g,P=/%\w`(\d+)`\w%/,Z=0,X=function(t,r){var e,n,o;for(t=t.replace(w,function(t,r){var e;return r?(e="%s`"+ ++Z+"`s%",D[Z]=r.replace(/^\\/,""),e):""}),e=r?M:_;n=e.exec(t);)o="%b`"+ ++Z+"`b%",D[Z]=n[0],t=t.replace(e,o);return t},F=function(t){var r;if(null==t)return t;for(;r=P.exec(t);)t=t.replace(P,D[r[1]]);return t.trim()},N=null!=V.geom?V.geom:V.geom={},b=function(){function t(t,r,e){var n,o,a,i;for(null==e&&(e=!0),a=this,a.type=t,a.contours=[],i=0,o=r.length;o>i;i++)n=r[i],I(n)||n.reverse(),a.contours.push(n);a.closed=e}return t.prototype.clipToBBox=function(t){throw"path clipping is not implemented yet"},t.prototype.toSVG=function(t){var r;return r=this.svgString(),t.path(r)},t.prototype.svgString=function(){var t,r,e,n,o,a,i,s,l,u,p,h,c;for(a=this,l="",e=a.closed?"Z M":"M",i=a.contours,u=0,n=i.length;n>u;u++)for(t=i[u],r=!0,l+=""===l?"M":e,p=0,o=t.length;o>p;p++)s=t[p],h=s[0],c=s[1],r||(l+="L"),l+=h+","+c,r=!1;return a.closed&&(l+="Z"),l},t.prototype.area=function(){var t,r,e,n,o,a;if(n=this,null!=n.areas)return n._area;for(n.areas=[],n._area=0,o=n.contours,a=0,e=o.length;e>a;a++)r=o[a],t=S(r),n.areas.push(t),n._area+=t;return n._area},t.prototype.centroid=function(){var t,r,e,n,o,a,i,s,l,u,p,h,c,f,y,d,v,g,m,b,x,_,w,M,P,L,j,k,B,A,S,I,C,z,T,G,N;if(m=this,null!=m._centroid)return m._centroid;for(a=m.area(),l=u=0,f=B=0,_=m.contours.length-1;_>=0?_>=B:B>=_;f=_>=0?++B:--B)if(s=m.contours[f],i=[],v=s.length,e=m.areas[f],d=e/a,0!==d){for(y=S=0,w=v-1;w>=0?w>=S:S>=w;y=w>=0?++S:--S)if(b=s[y],x=s[(y+1)%v],p=0,i.push(b),b[0]===x[0]&&(p=Math.abs(b[1]-x[1])),b[1]===x[1]&&(p=Math.abs(b[0]-x[0])),p>10)for(t=Math.floor(2*p),j=N=1,M=t-1;M>=1?M>=N:N>=M;j=M>=1?++N:--N)k=[b[0]+j/t*(x[0]-b[0]),b[1]+j/t*(x[1]-b[1])],i.push(k);for(C=T=z=G=0,v=i.length,r=[],A=0,y=n=0,P=v-1;P>=0?P>=n:n>=P;y=P>=0?++n:--n)b=i[y],x=i[(y+1)%v],h=x[0]-b[0],c=x[1]-b[1],g=Math.sqrt(h*h+c*c),r.push(g),A+=g;for(y=o=0,L=v-1;L>=0?L>=o:o>=L;y=L>=0?++o:--o)b=i[y],I=r[y]/A,C+=I*b[0],T+=I*b[1];l+=C*d,u+=T*d}return m._centroid=[l,u],m._centroid},t.prototype.isInside=function(t,r){var e,n,o,a,i,s;if(a=this,e=a._bbox,t<e[0]||t>e[2]||r<e[1]||r>e[3])return!1;for(o=s=0,i=a.contours.length-1;i>=0?i>=s:s>=i;o=i>=0?++s:--s)if(n=a.contours[o],C(n,[t,r]))return!0;return!1},t}(),V.geom.Path=b,i=function(t){function r(t,e,n){this.x=t,this.y=e,this.r=n,r.__super__.constructor.call(this,"circle",null,!0)}return $(r,t),r.prototype.toSVG=function(t){var r;return r=this,t.circle(r.x,r.y,r.r)},r.prototype.centroid=function(){var t;return t=this,[t.x,t.y]},r.prototype.area=function(){var t;return t=this,Math.PI*t.r*m.r},r}(b),V.geom.Circle=i,b.fromSVG=function(t){var r,e,n,o,a,i,s,l,u,p,h,c,f,y;if(o=[],y=t.nodeName,h=null,"path"===y){for(u=t.getAttribute("d").trim(),l=Snap.parsePathString(u),r="Z"===l[l.length-1],c=r?"Z M":"M",n=[],f=0,s=l.length;s>f;f++)e=l[f],0!==e.length&&("M"===e[0]?(n.length>2&&(o.push(n),n=[]),n.push([e[1],e[2]])):"L"===e[0]?n.push([e[1],e[2]]):"Z"===e[0]&&n.length>2&&(o.push(n),n=[]));n.length>=2&&(o.push(n),n=[]),h=new N.Path(y,o,r)}else"circle"===y&&(a=t.getAttribute("cx"),i=t.getAttribute("cy"),p=t.getAttribute("r"),h=new N.Circle(a,i,p));return h},y=function(){function t(t){this.points=t}return t.prototype.clipToBBox=function(r){var e,n,o,a,i,s,l,u,p,h,c,f,y,d,v,g,m,b,x,_,w;for(g=this,e=(new N.clipping.CohenSutherland).clip,c=[],s=[],i=!1,a=m=0,f=g.points.length-2;f>=0?f>=m:m>=f;a=f>=0?++m:--m){y=g.points[a],l=y[0],u=y[1],d=g.points[a+1],p=d[0],h=d[1];try{v=e(r,l,u,p,h),b=v[0],_=v[1],x=v[2],w=v[3],i=!0,c.push([b,_]),(p!==x||h!==_||a===len(g.points)-2)&&c.push([x,w])}catch(o){n=o,i&&c.length>1&&(s.push(new t(c)),c=[]),i=!1}}return c.length>1&&s.push(new t(c)),s},t.prototype.toSVG=function(){var t,r,e,n,o,a,i,s;for(o=this,r=[],e=o.points,a=0,t=e.length;t>a;a++)n=e[a],i=n[0],s=n[1],r.push(i+","+s);return"M"+r.join("L")},t}(),V.geom.Line=y,C=function(t,r){var e,n,o,a,i,s,l,u,p,h,c,f,y,d,v;for(s=Math.PI,n=Math.atan2,c=2*s,i=t.length,e=0,a=u=0,l=i-1;l>=0?l>=u:u>=l;a=l>=0?++u:--u){for(f=t[a][0]-r[0],d=t[a][1]-r[1],y=t[(a+1)%i][0]-r[0],v=t[(a+1)%i][1]-r[1],p=n(d,f),h=n(v,y),o=h-p;o>s;)o-=c;for(;-s>o;)o+=c;e+=o}return Math.abs(e)>=s},I=function(t){return S(t)>0},S=function(t){var r,e,n,o,a,i,s,l,u;for(o=0,e=t.length,r=a=0,n=e;n>=0?n>a:a>n;r=n>=0?++a:--a)i=t[r][0],l=t[r][1],s=t[(r+1)%e][0],u=t[(r+1)%e][1],o+=i*u-s*l;return o*=.5},R=V.proj=H.kartograph.proj={},Function.prototype.bind=function(t){var r;return r=this,function(){return r.apply(t,arguments)}},x=function(){function t(t){var r,e,n;r=this,r.lon0=null!=(e=t.lon0)?e:0,r.lat0=null!=(n=t.lat0)?n:0,r.PI=Math.PI,r.HALFPI=.5*r.PI,r.QUARTERPI=.25*r.PI,r.RAD=r.PI/180,r.DEG=180/r.PI,r.lam0=r.rad(this.lon0),r.phi0=r.rad(this.lat0),r.minLat=-90,r.maxLat=90}return t.parameters=[],t.title="Projection",t.prototype.rad=function(t){return t*this.RAD},t.prototype.deg=function(t){return t*this.DEG},t.prototype.plot=function(t,r){var e,n,o,a,i,s,l,u,p,h,c;for(null==r&&(r=!0),i=[],e=!0,u=0,o=t.length;o>u;u++)s=t[u],a=s[0],n=s[1],p=this._visible(a,n),p&&(e=!1),l=this.project(a,n),h=l[0],c=l[1],!p&&r?i.push(this._truncate(h,c)):i.push([h,c]);return e?null:[i]},t.prototype.sea=function(){var t,r,e,n,o,a,i,s,l,u,p,h,c,f;for(p=this,a=p.project.bind(this),o=[],r=p.lon0,p.lon0=0,n=h=-180;180>=h;n=++h)o.push(a(n,p.maxLat));for(e=c=i=p.maxLat,s=p.minLat;s>=i?s>=c:c>=s;e=s>=i?++c:--c)o.push(a(180,e));for(n=f=180;f>=-180;n=--f)o.push(a(n,p.minLat));for(e=t=l=p.minLat,u=p.maxLat;u>=l?u>=t:t>=u;e=u>=l?++t:--t)o.push(a(-180,e));return p.lon0=r,o},t.prototype.world_bbox=function(){var t,r,e,n,a,i;for(e=this.project.bind(this),a=this.sea(),t=new o,i=0,r=a.length;r>i;i++)n=a[i],t.update(n[0],n[1]);return t},t.prototype.toString=function(){var t;return t=this,"[Proj: "+t.name+"]"},t}(),x.fromXML=function(t){var r,e,n,o,a,i,s;for(n=t.getAttribute("id"),o={},e=s=0,i=t.attributes.length-1;i>=0?i>=s:s>=i;e=i>=0?++s:--s)r=t.attributes[e],"id"!==r.name&&(o[r.name]=r.value);if(null==R[n])throw"unknown projection "+n;return a=new R[n](o),a.name=n,a},V.Proj=x,n=function(t){function r(t,e){var n;null==e&&(e=1e3),r.__super__.constructor.call(this,t),n=this,n.r=e,n.elevation0=n.to_elevation(n.lat0),n.azimuth0=n.to_azimuth(n.lon0)}return $(r,t),r.parameters=["lon0","lat0"],r.title="Azimuthal Projection",r.prototype.to_elevation=function(t){var r;return r=this,(t+90)/180*r.PI-r.HALFPI},r.prototype.to_azimuth=function(t){var r;return r=this,(t+180)/360*r.PI*2-r.PI},r.prototype._visible=function(t,r){var e,n,o,a,i;return i=this,a=Math,o=i.to_elevation(r),e=i.to_azimuth(t),n=a.sin(o)*a.sin(i.elevation0)+a.cos(i.elevation0)*a.cos(o)*a.cos(e-i.azimuth0),n>=0},r.prototype._truncate=function(t,r){var e,n,o,a,i;return e=Math,n=this.r,o=e.atan2(r-n,t-n),a=n+n*e.cos(o),i=n+n*e.sin(o),[a,i]},r.prototype.sea=function(){var t,r,e,n,o;for(r=[],n=this.r,t=Math,e=o=0;360>=o;e=++o)r.push([n+t.cos(this.rad(e))*n,n+t.sin(this.rad(e))*n]);return r},r.prototype.world_bbox=function(){var t;return t=this.r,new o(0,0,2*t,2*t)},r}(x),L=function(t){function r(t){var e,n,o,a,i,s,l,u,p,h;for(r.__super__.constructor.call(this,{lon0:0,lat0:0}),this.dist=null!=(o=t.dist)?o:3,this.up=this.rad(null!=(a=t.up)?a:0),this.tilt=this.rad(null!=(i=t.tilt)?i:0),this.scale=1,p=Number.MAX_VALUE,u=-1*Number.MAX_VALUE,e=s=0;179>=s;e=++s)for(n=l=0;360>=l;n=++l)h=this.project(n-180,e-90),p=Math.min(h[0],p),u=Math.max(h[0],u);this.scale=2*this.r/(u-p),r.__super__.constructor.call(this,t)}return $(r,t),r.parameters=["lon0","lat0","tilt","dist","up"],r.title="Satellite Projection",r.prototype.project=function(t,r,e){var n,o,a,i,s,l,u,p,h,c,f,y,d,v,g,m,b,x,_,w,M;return null==e&&(e=0),c=this.rad(r),p=this.rad(t),h=Math,d=h.sin,a=h.cos,f=this.r,y=f*(e+6371)/3671,i=d(this.phi0)*d(c)+a(this.phi0)*a(c)*a(p-this.lam0),u=(this.dist-1)/(this.dist-i),u=(this.dist-1)/(this.dist-i),u*=this.scale,b=y*u*a(c)*d(p-this.lam0),w=-y*u*(a(this.phi0)*d(c)-d(this.phi0)*a(c)*a(p-this.lam0)),l=a(this.up),g=d(this.up),s=a(this.tilt),v=d(this.tilt),o=y*(this.dist-1),n=(w*l+b*g)*d(this.tilt)/o+s,x=(b*l-w*g)*a(this.tilt)/n,M=(w*l+b*g)/n,m=f+x,_=f+M,[m,_]},r.prototype._visible=function(t,r){var e,n,o,a;return o=this.to_elevation(r),e=this.to_azimuth(t),a=Math,n=a.sin(o)*a.sin(this.elevation0)+a.cos(this.elevation0)*a.cos(o)*a.cos(e-this.azimuth0),n>=1/this.dist},r.prototype.sea=function(){var t,r,e,n,o;for(r=[],n=this.r,t=Math,e=o=0;360>=o;e=++o)r.push([n+t.cos(this.rad(e))*n,n+t.sin(this.rad(e))*n]);return r},r}(n),R.satellite=L,A=function(){function t(t,r,e,n,o,a){var i;i=this,i.bbox=t,i.width=r,i.padding=null!=n?n:0,i.halign=null!=o?o:"center",i.valign=null!=a?a:"center",i.height=e,i.scale=Math.min((r-2*n)/t.width,(e-2*n)/t.height)}return t.prototype.project=function(t,r){var e,n,o,a,i,s,l;return null==r&&(r=t[1],t=t[0]),o=this,a=o.scale,e=o.bbox,n=o.height,i=o.width,s="center"===o.halign?.5*(i-e.width*a):"left"===o.halign?o.padding*a:i-(e.width-o.padding)*a,l="center"===o.valign?.5*(n-e.height*a):"top"===o.valign?o.padding*a:0,t=(t-e.left)*a+s,r=(r-e.top)*a+l,[t,r]},t.prototype.projectPath=function(t){var r,e,n,o,a,i,s,l,u,p,h,c,f,y,d,v,g;if(i=this,"path"===t.type){for(n=[],r=[99999,99999,-99999,-99999],p=t.contours,y=0,o=p.length;o>y;y++){for(l=p[y],e=[],d=0,a=l.length;a>d;d++)h=l[d],v=h[0],g=h[1],c=i.project(v,g),v=c[0],g=c[1],e.push([v,g]),r[0]=Math.min(r[0],v),r[1]=Math.min(r[1],g),r[2]=Math.max(r[2],v),r[3]=Math.max(r[3],g);n.push(e)}return s=new N.Path(t.type,n,t.closed),s._bbox=r,s}return"circle"===t.type?(f=i.project(t.x,t.y),v=f[0],g=f[1],u=t.r*i.scale,new N.Circle(v,g,u)):void 0},t.prototype.asBBox=function(){var t;return t=this,new o(0,0,t.width,t.height)},t}(),A.fromXML=function(t){var r,e,n,a,i;return i=Number(t.getAttribute("w")),n=Number(t.getAttribute("h")),a=Number(t.getAttribute("padding")),e=t.getElementsByTagName("bbox")[0],r=o.fromXML(e),new A(r,i,n,a)},H.kartograph.View=A,k=function(){function t(t){r=this,r.location=t.location,r.data=t.data,r.map=t.map,r.layers=t.layers,r.key=t.key,r.x=t.x,r.y=t.y}var r;return r=null,t.prototype.init=function(){return r},t.prototype.overlaps=function(t){return!1},t.prototype.update=function(t){return r},t.prototype.nodes=function(){return[]},t.prototype.clear=function(){return r},t}(),V.Symbol=k,B=function(){function r(t){this._initTooltips=K(this._initTooltips,this),this._noverlap=K(this._noverlap,this),this._kMeans=K(this._kMeans,this);var e,o,a,i,s,l,u,p,h,c,f,y,d,v,g,m,b,x,_,w;for(n=this,b=["data","location","type","map"],d=["filter","tooltip","click","delay","sortBy","clustering","aggregate","clusteringOpts","mouseenter","mouseleave"],x=0,p=b.length;p>x;x++){if(v=b[x],null==t[v])throw"SymbolGroup: missing argument '"+v+"'";n[v]=t[v]}for(_=0,h=d.length;h>_;_++)v=d[_],null!=t[v]&&(n[v]=t[v]);if(e=n.type,null==e)return void Y("could not resolve symbol type",n.type);for(g=e.props,w=0,c=g.length;c>w;w++)v=g[w],null!=t[v]&&(n[v]=t[v]);for(n.layers={mapcanvas:n.map.paper},m=e.layers,o=0,f=m.length;f>o;o++)l=m[o],y=r._layerid++,s="sl_"+y,"svg"===l.type?u=n.map.createSVGLayer(s):"html"===l.type&&(u=n.map.createHTMLLayer(s)),n.layers[l.id]=u;n.symbols=[];for(i in n.data)a=n.data[i],"function"===z(n.filter)?n.filter(a,i)&&n.add(a,i):n.add(a,i);n.layout(),n.render(),n.map.addSymbolGroup(n)}var n;return n=null,r.prototype.add=function(t,r){var e,o,a,i,s,l,u,p;for(n=this,e=n.type,a=n._evaluate(n.location,t,r),"array"===z(a)&&(a=new d(a[0],a[1])),l={layers:n.layers,location:a,data:t,key:null!=r?r:n.symbols.length,map:n.map},s=e.props,p=0,o=s.length;o>p;p++)i=s[p],null!=n[i]&&(l[i]=n._evaluate(n[i],t,r));return u=new e(l),n.symbols.push(u),u},r.prototype.layout=function(){var t,r,e,o,a,i,s,l,u,p;for(i=n.symbols,u=0,r=i.length;r>u;u++){if(l=i[u],e=l.location,"string"===z(e)){if(s=e.split("."),t=s[0],a=s[1],o=n.map.getLayerPath(t,a),null==o){Y("could not find layer path "+t+"."+a);continue}p=n.map.viewBC.project(o.path.centroid())}else p=n.map.lonlat2xy(e);l.x=p[0],l.y=p[1]}return"k-means"===n.clustering?n._kMeans():"noverlap"===n.clustering&&n._noverlap(),n},r.prototype.render=function(){var t,r,o,a,i,s,l,u,p,h,c;for(n=this,n.sortBy&&(p="asc","string"===z(n.sortBy)&&(n.sortBy=n.sortBy.split(" ",2),u=n.sortBy[0],p=null!=(a=n.sortBy[1])?a:"asc"),n.symbols=n.symbols.sort(function(t,r){var e,o,a;return"function"===z(n.sortBy)?(o=n.sortBy(t.data,t),a=n.sortBy(r.data,r)):(o=t[u],a=r[u]),o===a?0:(e="asc"===p?1:-1,o>a?1*e:-1*e)})),i=n.symbols,h=0,t=i.length;t>h;h++)for(l=i[h],l.render(),s=l.nodes(),c=0,r=s.length;r>c;c++)o=s[c],o.symbol=l;return"function"===z(n.tooltip)&&n._initTooltips(),e.each(["click","mouseenter","mouseleave"],function(t,r){var a,i,s,u;if("function"===z(n[r])){for(i=n.symbols,s=[],u=0,a=i.length;a>u;u++)l=i[u],s.push(function(){var t,a,i,s;for(i=l.nodes(),s=[],t=0,a=i.length;a>t;t++)o=i[t],s.push(e(o)[r](function(t){return function(t){var o;for(o=t.target;!o.symbol;)o=e(o).parent().get(0);return t.stopPropagation(),n[r](o.symbol.data,o.symbol,t)}}(this)));return s}.call(this));return s}}),n},r.prototype.tooltips=function(t){return n=this,n.tooltips=t,n._initTooltips(),n},r.prototype.remove=function(t){var r,e,o,a,i,s,l,u,p,h,c;for(n=this,a=[],l=n.symbols,c=0,s=l.length;s>c;c++)if(h=l[c],null==t||t(h.data))try{h.clear()}catch(e){r=e,Y("error: symbolgroup.remove")}else a.push(h);if(null==t){u=n.layers,p=[];for(o in u)i=u[o],"mapcanvas"!==o?p.push(i.remove()):p.push(void 0);return p}return n.symbols=a},r.prototype._evaluate=function(t,r,e){var n;return n="function"===z(t)?t(r,e):t},r.prototype._kMeans=function(){var r,e,o,a,i,s,l,u,p,h,c,f,y,d,v,g,m,b,x,_,w,M;for(n=this,null==n.osymbols&&(n.osymbols=n.symbols),r=n.type,null!=n.clusteringOpts&&(b=n.clusteringOpts.size),null==b&&(b=64),o=t().iterations(16).size(b),d=n.osymbols,_=0,s=d.length;s>_;_++)m=d[_],o.add({x:m.x,y:m.y});for(c=o.means(),f=[],w=0,l=c.length;l>w;w++)if(h=c[w],0!==h.size){for(a=[],v=h.indices,M=0,u=v.length;u>M;M++)i=v[M],a.push(n.osymbols[i].data);for(a=n.aggregate(a),x={layers:n.layers,location:!1,data:a,map:n.map},g=r.props,e=0,p=g.length;p>e;e++)y=g[e],null!=n[y]&&(x[y]=n._evaluate(n[y],a));m=new r(x),m.x=h.x,m.y=h.y,f.push(m)}return n.symbols=f},r.prototype._noverlap=function(){var t,r,e,o,a,i,s,l,u,p,h,c,f,y,d,v,g,m,b,x,_,w,M,P,L,j,k,B,A,S,I,C,z,T,G,N,V,O,E,X,D,U,R,q,F,H;if(n=this,null==n.osymbols&&(n.osymbols=n.symbols),c=3,t=n.type,J.call(t.props,"radius")<0)return void Y('noverlap layout only available for symbols with property "radius"');for(V=n.osymbols.slice(),null!=n.clusteringOpts&&(D=n.clusteringOpts.tolerance,b=n.clusteringOpts.maxRatio),null==D&&(D=.05),null==b&&(b=.8),p=O=0,B=c-1;B>=0?B>=O:O>=B;p=B>=0?++O:--O){for(V.sort(function(t,r){return r.radius-t.radius}),f=V.length,x=[],_=U=0,A=f-3;A>=0?A>=U:U>=A;_=A>=0?++U:--U)if(T=V[_]){for(j=T.radius*(1-D),y=T.x-j,P=T.x+j,E=T.y-j,a=T.y+j,h=[],w=H=S=_+1,I=f-2;I>=S?I>=H:H>=I;w=I>=S?++H:--H)G=V[w],G&&(k=G.radius,
d=G.x-k,L=G.x+k,X=G.y-k,i=G.y+k,k/T.radius<b&&(d>P||y>L||X>a||E>i||(l=G.x-T.x,u=G.y-T.y,(j+k)*(j+k)>l*l+u*u&&h.push(w))));if(h.length>0){for(s=[T.data],M=T.radius*T.radius,r=0,v=h.length;v>r;r++)p=h[r],s.push(V[p].data),M+=V[p].radius*V[p].radius;for(s=n.aggregate(s),N={layers:n.layers,location:!1,data:s,map:n.map},C=t.props,e=0,g=C.length;g>e;e++)_=C[e],null!=n[_]&&(N[_]=n._evaluate(n[_],s));for(z=new t(N),R=T.radius*T.radius/M,q=T.x*R,F=T.y*R,o=0,m=h.length;m>o;o++)p=h[o],G=V[p],R=G.radius*G.radius/M,q+=G.x*R,F+=G.y*R,V[p]=void 0;z.x=q,z.y=F,V[_]=void 0,x.push(z)}else x.push(T)}V=x}return n.symbols=V},r.prototype._initTooltips=function(){var t,r,o,a,i,s,l,u,p,h,c;for(n=this,p=n.tooltip,i=n.symbols,u=0,r=i.length;r>u;u++)for(l=i[u],t={position:{target:"mouse",viewport:e(window),adjust:{x:7,y:7}},show:{delay:20},content:{},events:{show:function(t,r){return e(".qtip").filter(function(){return this!==r.elements.tooltip.get(0)}).hide()}}},h=p(l.data,l.key),"string"===z(h)?t.content.text=h:"array"===z(h)&&(t.content.title=h[0],t.content.text=h[1]),s=l.nodes(),c=0,o=s.length;o>c;c++)a=s[c],e(a).qtip(t)},r.prototype.onResize=function(){var t,r,e,o;for(n=this,n.layout(),r=n.symbols,o=0,t=r.length;t>o;o++)e=r[o],e.update()},r.prototype.update=function(t,r,e){var o,a,i,s,l,u,p,h;for(n=this,null==t&&(t={}),s=n.symbols,p=0,o=s.length;o>p;p++){for(u=s[p],l=n.type.props,h=0,a=l.length;a>h;h++)i=l[h],null!=t[i]?u[i]=n._evaluate(t[i],u.data):null!=n[i]&&(u[i]=n._evaluate(n[i],u.data));u.update(r,e)}return n},r}(),B._layerid=0,V.SymbolGroup=B,h.prototype.addSymbols=function(t){return t.map=this,new B(t)},V.dorlingLayout=function(t,r){var n,o,a,i,s,l,u,p,h,c,f,y,d,v,g,m;for(null==r&&(r=40),f=[],e.each(t.symbols,function(t,r){return f.push({i:t,x:r.path.attrs.cx,y:r.path.attrs.cy,r:r.path.attrs.r})}),f.sort(function(t,r){return r.r-t.r}),a=function(){var r,e,n;for(n=0,r=f.length;r>n;n++)e=f[n],t.symbols[e.i].path.attr({cx:e.x,cy:e.y})},y=m=1,v=r;v>=1?v>=m:m>=v;y=v>=1?++m:--m)for(h in f)for(c in f)if(c>h){if(n=f[h],o=f[c],n.x+n.r<o.x-o.r||n.x-n.r>o.x+o.r)continue;if(n.y+n.r<o.y-o.r||n.y-n.r>o.y+o.r)continue;l=n.x-o.x,u=n.y-o.y,s=l*l+u*u,d=n.r+o.r,g=d*d,g>s&&(i=Math.sqrt(s),p=10/i,n.x+=l*p*(1-n.r/d),n.y+=u*p*(1-n.r/d),o.x-=l*p*(1-o.r/d),o.y-=u*p*(1-o.r/d))}return a()},a=function(t){function r(t){this.nodes=K(this.nodes,this),this.clear=K(this.clear,this),this.update=K(this.update,this),this.render=K(this.render,this),this.overlaps=K(this.overlaps,this);var e,n,o;e=this,r.__super__.constructor.call(this,t),e.radius=null!=(n=t.radius)?n:4,e.style=t.style,e.attrs=t.attrs,e.title=t.title,e["class"]=null!=(o=t["class"])?o:"bubble"}return $(r,t),r.prototype.overlaps=function(t){var r,e,n,o,a,i,s,l,u,p,h;return n=this,i=[n.x,n.y,n.radius],l=i[0],p=i[1],o=i[2],s=[t.x,t.y,t.radius],u=s[0],h=s[1],a=s[2],l-o>u+a||u-a>l+o||p-o>h+a||h-a>p+o?!1:(r=l-u,e=p-h,r*r+e*e>(o+a)*(o+a)?!1:!0)},r.prototype.render=function(t){var r;return r=this,null==r.path&&(r.path=r.layers.mapcanvas.circle(r.x,r.y,r.radius)),r.update(),r.map.applyCSS(r.path),r},r.prototype.update=function(t,r){var n,o,a;return null==t&&(t=!1),null==r&&(r="expo-out"),o=this,a=o.path,n={cx:o.x,cy:o.y,r:o.radius},null!=o.attrs&&(n=e.extend(n,o.attrs)),t?a.animate(n,t,r):a.attr(n),null!=a.node&&(null!=o.style&&a.node.setAttribute("style",o.style),null!=o["class"]&&a.node.setAttribute("class",o["class"])),null!=o.title&&a.attr("title",o.title),o},r.prototype.clear=function(){var t;return t=this,t.path.remove(),t},r.prototype.nodes=function(){var t;return t=this,[t.path.node]},r}(k),a.props=["radius","style","class","title","attrs"],a.layers=[],H.kartograph.Bubble=a,j=function(t){function r(t){var e,n,o,a,i;e=this,r.__super__.constructor.call(this,t),e.text=null!=(n=t.text)?n:"",e.style=null!=(o=t.style)?o:"",e["class"]=null!=(a=t["class"])?a:"",e.offset=null!=(i=t.offset)?i:[0,0]}return $(r,t),r.prototype.render=function(t){var r,e;return e=this,e.lbl=r=e.layers.mapcanvas.text(e.x,e.y,e.text),e.update(),e},r.prototype.update=function(){var t;return t=this,t.lbl.attr({x:t.x+t.offset[0],y:t.y+t.offset[1]}),t.lbl.node.setAttribute("style",t.style),t.lbl.node.setAttribute("class",t["class"])},r.prototype.clear=function(){var t;return t=this,t.lbl.remove(),t},r.prototype.nodes=function(){var t;return t=this,[t.lbl.node]},r}(V.Symbol),j.props=["text","style","class","offset"],j.layers=[],H.kartograph.Label=j,u=function(t){function r(t){var e,n,o,a;e=this,r.__super__.constructor.call(this,t),e.text=null!=(n=t.text)?n:"",e.css=null!=(o=t.css)?o:"",e["class"]=null!=(a=t["class"])?a:""}return $(r,t),r.prototype.render=function(t){var r,n,o;return o=this,r=e("<div>"+o.text+"</div>"),r.css({width:"80px",position:"absolute",left:"-40px","text-align":"center"}),o.lbl=n=e('<div class="label" />'),n.append(r),o.layers.lbl.append(n),r.css({height:r.height()+"px",top:r.height()*-.4+"px"}),o.update(),o},r.prototype.update=function(){var t;return t=this,t.lbl.css({position:"absolute",left:t.x+"px",top:t.y+"px"}),t.lbl.css(t.css)},r.prototype.clear=function(){var t;return t=this,t.lbl.remove(),t},r.prototype.nodes=function(){var t;return t=this,[t.lbl[0]]},r}(V.Symbol),u.props=["text","css","class"],u.layers=[{id:"lbl",type:"html"}],H.kartograph.HtmlLabel=u,c=function(t){function r(t){this.nodes=K(this.nodes,this),this.clear=K(this.clear,this),this.update=K(this.update,this),this.render=K(this.render,this);var e,n,o;e=this,r.__super__.constructor.call(this,t),e.labelattrs=null!=(n=t.labelattrs)?n:{},e.buffer=t.buffer,e.center=null!=(o=t.center)?o:!0}return $(r,t),r.prototype.render=function(t){var e;return e=this,null!=e.title&&""!==String(e.title).trim()&&(e.buffer&&(e.bufferlabel=e.layers.mapcanvas.text(e.x,e.y,e.title)),e.label=e.layers.mapcanvas.text(e.x,e.y,e.title)),r.__super__.render.call(this,t),e},r.prototype.update=function(t,n){var o,a,i,s,l;return null==t&&(t=!1),null==n&&(n="expo-out"),a=this,r.__super__.update.call(this,t,n),null!=a.label&&(i=a.map.viewport,o=e.extend({},a.labelattrs),s=a.x,l=a.y,a.center?l-=0:s>.5*i.width?(o["text-anchor"]="end",s-=a.radius+5):s<.5*i.width&&(o["text-anchor"]="start",s+=a.radius+5),o.x=s,o.y=l,a.buffer&&(a.bufferlabel.attr(o),a.bufferlabel.attr({stroke:"#fff",fill:"#fff","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":6})),a.label.attr(o),a.label.toFront()),a},r.prototype.clear=function(){var t;return t=this,r.__super__.clear.apply(this,arguments)},r.prototype.nodes=function(){var t,e;return t=this,e=r.__super__.nodes.apply(this,arguments),t.label&&e.push(t.label.node),t.bufferlabel&&e.push(t.bufferlabel.node),e},r}(a),c.props=["radius","style","class","title","labelattrs","buffer","center","attrs"],c.layers=[],H.kartograph.LabeledBubble=c}).call(this);